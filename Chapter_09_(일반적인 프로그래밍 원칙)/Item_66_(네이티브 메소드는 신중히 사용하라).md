# Item 66. 네이티브 메소드는 신중히 사용하라

### 내용 요약 <br>
1. 네이티브 메소드의 장점
    - 성능이 중요한 경우, 성능을 최적화하기 위해 사용될 수 있다. 특히, 자바에서 구현하기 어려운 하드웨어와 밀접한 작업이나 <br>
      성능이 중요한 작업에서 C/C++ 와 같은 네이티브 코드를 사용하는 경우가 있다. <br><br>

    - 기존의 레거시 코드와 통합할 때 유용하다. 기존에 C나 C++로 작성된 코드를 그대로 사용할 수 있다. <br><br>

2. 네이티브 메소드의 단점
    - 이식성
      - 자바의 장점 중 하나는 플랫폼 독립성이지만, 네이티브 메소드를 사용하면 해당 메소드는 특정 플랫폼(C/C++로 작성된 환경)에 의존하게 된다. <br><br>
      
    - 안전성 문제
      - 네이티브 코드는 자바의 자동 메모리 관리(가비지 컬렉션)을 우회하기 때문에 메모리 누수나 버퍼 오버플로우와 같은 문제가 발생할 수 있다. <br><br>
    
    - 디버깅의 어려움
      - 네이티브 코드의 디버깅은 자바 코드만 사용할 때보다 더 어렵고 복잡해질 수 있다. <br><br>
      
    - 성능 문제
      - 예상과 달리 네이티브 메소드가 항상 빠른 것은 아니다. 자바와 네이티브 코드 간의 호출 비용이 발생할 수 있다. <br><br>


3. 대안
    - 네이티브 메소드가 반드시 필요한 경우가 아니라면, 순수 자바 코드로 구현하는 것이 더 바람직하다. <br>
      자바의 성능이 충분히 최적화되었기 때문에 네이티브 메소드를 사용할 필요가 있는 상황은 점점 줄어들고 있다. <br><br>

4. 네이티브 메소드 사용 시, 가이드라인 :
    - 반드시 네이티브 메소드를 사용해야 하는 경우에만 사용하고 자바 코드로 대체할 수 있으면 자바 코드로 대체하는 것이 좋다. <br><br>
    - 네이티브 코드와의 상호작용을 최소화하여 네이티브와 자바 간의 호출 비용을 줄이는 것이 중요하다. <br><br>


<br><br>



### 네이티브 메소드를 사용하는 예시 (C 코드 연동)
```java
public class NativeExample {

    // 네이티브 메소드 선언
    public native int sum(int a, int b);
    
    // 네이티브 라이브러리 로드
    static {
        System.loadLibrary("NativeExample");
    }
    
    public static void main(String[] args) {
        
        NativeExample example = new NativeExample();
        int result = example.sum(5, 3);
        System.out.println("Sum from native method : " + result);
    }
}
```
위 코드에선 `sum`이라는 네이티브 메소드를 호출하는 예시이다. 이 메소드는 C언어로 구현되어 있으며 <br>
자바가 아닌 네이티브 라이브러리를 호출한다. `JNI (Java Native Interface)`를 통해 이와 같은 연결이 가능하다. <br><br>

`NativeExample` 클래스는 네이티브 메소드인 `sum`을 선언하고 C로 작성된 네이티브 라이브러리를 불러와 사용한다. <br>
`System.loadLibrary("NativeExample")`는 네이티브 라이브러리를 로드하는 역할을 한다. <br><br>

`JNI`는 자바에서 네이티브 메소드를 호출하는 인터페이스로 이를 통해 자바 코드가 C/C++로 작성된 네이티브 코드를 실행할 수 있다. <br>
하지만, 이 방법은 이식성이 떨어지며 플랫폼에 종속적이기 때문에 자바의 플랫폼 독립적 특성을 잃게 된다.

<br><br>


### C로 작성된 네이티브 코드
```c
#include <jni.h>
#include "NativeExample.h"

JNIEXPORT jint JNICALL Java_NativeExample_sum(JNIEnv *env, jobject thisObj, jint a, jint b) {
   return a + b;
}
```

위 코드에선 `NativeExample`이라는 C파일로 자바 클래스에서 정의된 `sum` 메소드를 구현한 것. <br>
이 C파일은 자바 네이티브 메소드 호출을 처리하며, 두 개의 정수 값을 더하는 간단한 기능을 수행한다. <br><br>

<br><br>



### 정리하자면
1. 네이티브 메소드는 필요한 경우에만 신중하게 사용해야 한다. 이식성, 안정성, 성능 문제를 야기할 수 있기 때문이다
2. 자바의 성능은 지속적으로 개선되고 있기 때문에 성능 상의 이유로 네이티브 코드를 사용할 필요성은 줄어들고 있다
3. 대안적으로 자바에서 가능한 부분은 자바 코드로 작성하는 것이 더 바람직하다


